{
  "openapi": "3.0.3",
  "info": {
    "title": "Review API",
    "version": "1.1.0",
    "description": "리뷰 + AI 리뷰 요약 API (JWT 기반)"
  },
  "servers": [
    { "url": "http://localhost:8080" }
  ],
  "security": [
    { "bearerAuth": [] }
  ],
  "paths": {


    "/api/v1/admin/reviews/{productId}/ai-summary": {
      "post": {
        "summary": "관리자 AI 리뷰 요약 재생성",
        "tags": ["Admin Review"],
        "parameters": [
          {
            "name": "productId",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "uuid" }
          }
        ],
        "responses": {
          "200": { "description": "AI 리뷰 요약 생성 요청 성공" },
          "401": { "description": "인증 실패" },
          "403": { "description": "관리자 권한 필요" }
        }
      }
    },


    "/api/v1/reviews/product/{productId}/": {
      "get": {
        "summary": "상품 리뷰 목록 + AI 리뷰",
        "description": "비로그인 사용자도 조회 가능",
        "tags": ["Product Review"],
        "security": [],
        "parameters": [
          {
            "name": "productId",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "uuid" }
          },
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "default": 0 }
          },
          {
            "name": "size",
            "in": "query",
            "schema": { "type": "integer", "default": 10 }
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["latest", "rating", "like"],
              "default": "latest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ProductReviewResponse" }
              }
            }
          }
        }
      }
    },

    "/api/v1/reviews/{orderId}/items/{productId}": {
      "post": {
        "summary": "내 주문 상품 리뷰 작성",
        "tags": ["Review"],
        "parameters": [
          { "name": "orderId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } },
          { "name": "productId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateReviewRequest" }
            }
          }
        },
        "responses": {
          "201": { "description": "리뷰 생성 성공" },
          "401": { "description": "인증 실패" }
        }
      }
    },

    "/api/v1/reviews/me/{reviewId}": {
      "get": {
        "summary": "내 리뷰 단건 조회",
        "tags": ["Review"],
        "parameters": [
          { "name": "reviewId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReviewResponse" }
              }
            }
          }
        }
      }
    },

    "/api/v1/reviews/me": {
      "get": {
        "summary": "내 리뷰 목록 조회",
        "tags": ["Review"],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 0 } },
          { "name": "size", "in": "query", "schema": { "type": "integer", "default": 10 } }
        ],
        "responses": {
          "200": { "description": "조회 성공" }
        }
      }
    },

    "/api/v1/reviews/{reviewId}": {
      "put": {
        "summary": "내 리뷰 수정",
        "tags": ["Review"],
        "parameters": [
          { "name": "reviewId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UpdateReviewRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "수정 성공" }
        }
      },
      "delete": {
        "summary": "권한 기반 리뷰 삭제",
        "tags": ["Review"],
        "parameters": [
          { "name": "reviewId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "responses": {
          "204": { "description": "삭제 성공" },
          "403": { "description": "권한 없음" }
        }
      }
    },

    "/api/v1/reviews/{reviewId}/like": {
      "post": {
        "summary": "리뷰 좋아요",
        "tags": ["Review"],
        "parameters": [
          { "name": "reviewId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "responses": {
          "200": { "description": "좋아요 수 반환" }
        }
      },
      "delete": {
        "summary": "리뷰 좋아요 취소",
        "tags": ["Review"],
        "parameters": [
          { "name": "reviewId", "in": "path", "required": true, "schema": { "type": "string", "format": "uuid" } }
        ],
        "responses": {
          "200": { "description": "좋아요 수 반환" }
        }
      }
    }
  },

  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },

    "schemas": {
      "CreateReviewRequest": {
        "type": "object",
        "required": ["rating", "content"],
        "properties": {
          "rating": { "type": "integer", "minimum": 1, "maximum": 5 },
          "content": { "type": "string" }
        }
      },

      "UpdateReviewRequest": {
        "type": "object",
        "properties": {
          "rating": { "type": "integer", "minimum": 1, "maximum": 5 },
          "content": { "type": "string" }
        }
      },

      "ReviewResponse": {
        "type": "object",
        "properties": {
          "reviewId": { "type": "string", "format": "uuid" },
          "productId": { "type": "string", "format": "uuid" },
          "rating": { "type": "integer" },
          "content": { "type": "string" },
          "likeCount": { "type": "integer" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      },

      "ProductReviewResponse": {
        "type": "object",
        "properties": {
          "avgRating": { "type": "number", "format": "double" },
          "reviewCount": { "type": "integer" },
          "aiReview": { "type": "string", "nullable": true },
          "reviews": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ReviewResponse" }
          }
        }
      }
    }
  }
}
